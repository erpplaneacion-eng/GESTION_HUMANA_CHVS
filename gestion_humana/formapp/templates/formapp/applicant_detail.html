{% extends 'base.html' %}
{% load static %}

{% block title %}Detalle de {{ applicant.nombre_completo }}{% endblock %}

{% block content %}
<div class="detail-container">
    <!-- Header con información principal -->
    <div class="detail-header">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h1 class="mb-2">
                    <i class="fas fa-user-circle"></i> {{ applicant.nombre_completo }}
                </h1>
                <p class="mb-1"><i class="fas fa-id-card"></i> <strong>Cédula:</strong> {{ applicant.cedula }}</p>
                <p class="mb-1"><i class="fas fa-briefcase"></i> <strong>Profesión:</strong> {{ applicant.profesion }}</p>
                <p class="mb-0"><i class="fas fa-graduation-cap"></i> <strong>Área:</strong> {{ applicant.area_del_conocimiento }}</p>
                
                <!-- Badge de Estado -->
                <div class="mt-2">
                    <span class="badge {% if applicant.estado == 'RECIBIDO' %}bg-info{% elif applicant.estado == 'EN_REVISION' %}bg-primary{% elif applicant.estado == 'PENDIENTE_CORRECCION' %}bg-warning{% elif applicant.estado == 'CORREGIDO' %}bg-success{% elif applicant.estado == 'VERIFICADO' %}bg-success{% else %}bg-secondary{% endif %}">
                        Estado: {{ applicant.get_estado_display }}
                    </span>
                </div>
            </div>
            <div class="text-end">
                <a href="{% url 'formapp:applicant_list' %}" class="btn btn-light btn-lg">
                    <i class="fas fa-arrow-left"></i> Volver
                </a>
                {% if user.is_staff %}
                <a href="{% url 'formapp:applicant_edit' applicant.pk %}" class="btn btn-warning btn-lg">
                    <i class="fas fa-edit"></i> Editar
                </a>
                <!-- Botón para abrir modal de corrección -->
                <button type="button" class="btn btn-danger btn-lg" data-bs-toggle="modal" data-bs-target="#correctionModal">
                    <i class="fas fa-exclamation-triangle"></i> Solicitar Corrección
                </button>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Modal de Solicitud de Corrección -->
    <div class="modal fade" id="correctionModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title"><i class="fas fa-envelope-open-text"></i> Solicitar Corrección al Candidato</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form method="post" action="{% url 'formapp:solicitar_correccion' applicant.pk %}">
                    {% csrf_token %}
                    <div class="modal-body">
                        <div class="alert alert-warning">
                            <i class="fas fa-info-circle"></i> Esta acción enviará un correo electrónico al candidato con un enlace seguro para que corrija la información.
                        </div>
                        <div class="mb-3">
                            <label for="mensaje_observacion" class="form-label"><strong>Motivo de la solicitud / Observaciones:</strong></label>
                            <textarea class="form-control" id="mensaje_observacion" name="mensaje_observacion" rows="5" required placeholder="Ej: El diploma de pregrado no es legible. Por favor adjuntar nuevamente en formato PDF."></textarea>
                        </div>

                        <div class="mb-3">
                            <label class="form-label"><strong>Selecciona los campos que el candidato debe corregir:</strong></label>
                            <div class="alert alert-info">
                                <i class="fas fa-lock"></i> Solo los campos seleccionados estarán habilitados para edición.
                            </div>

                            <div class="row">
                                <!-- Columna 1: Información Personal y Documentos -->
                                <div class="col-md-4">
                                    <h6 class="text-primary"><i class="fas fa-user"></i> Información Personal</h6>
                                    <div class="form-check">
                                        <input type="checkbox" name="campos" value="primer_nombre" class="form-check-input" id="campo_primer_nombre">
                                        <label class="form-check-label" for="campo_primer_nombre">Primer Nombre</label>
                                    </div>
                                    <div class="form-check">
                                        <input type="checkbox" name="campos" value="segundo_nombre" class="form-check-input" id="campo_segundo_nombre">
                                        <label class="form-check-label" for="campo_segundo_nombre">Segundo Nombre</label>
                                    </div>
                                    <div class="form-check">
                                        <input type="checkbox" name="campos" value="primer_apellido" class="form-check-input" id="campo_primer_apellido">
                                        <label class="form-check-label" for="campo_primer_apellido">Primer Apellido</label>
                                    </div>
                                    <div class="form-check">
                                        <input type="checkbox" name="campos" value="segundo_apellido" class="form-check-input" id="campo_segundo_apellido">
                                        <label class="form-check-label" for="campo_segundo_apellido">Segundo Apellido</label>
                                    </div>
                                    <div class="form-check">
                                        <input type="checkbox" name="campos" value="cedula" class="form-check-input" id="campo_cedula">
                                        <label class="form-check-label" for="campo_cedula">Cédula</label>
                                    </div>
                                    <div class="form-check">
                                        <input type="checkbox" name="campos" value="genero" class="form-check-input" id="campo_genero">
                                        <label class="form-check-label" for="campo_genero">Género</label>
                                    </div>
                                    <div class="form-check">
                                        <input type="checkbox" name="campos" value="telefono" class="form-check-input" id="campo_telefono">
                                        <label class="form-check-label" for="campo_telefono">Teléfono</label>
                                    </div>
                                    <div class="form-check">
                                        <input type="checkbox" name="campos" value="correo" class="form-check-input" id="campo_correo">
                                        <label class="form-check-label" for="campo_correo">Correo Electrónico</label>
                                    </div>
                                    <div class="form-check">
                                        <input type="checkbox" name="campos" value="tipo_via" class="form-check-input" id="campo_tipo_via">
                                        <label class="form-check-label" for="campo_tipo_via">Tipo de Vía</label>
                                    </div>
                                    <div class="form-check">
                                        <input type="checkbox" name="campos" value="numero_via" class="form-check-input" id="campo_numero_via">
                                        <label class="form-check-label" for="campo_numero_via">Número de Vía</label>
                                    </div>
                                    <div class="form-check">
                                        <input type="checkbox" name="campos" value="numero_casa" class="form-check-input" id="campo_numero_casa">
                                        <label class="form-check-label" for="campo_numero_casa">Número de Casa</label>
                                    </div>
                                    <div class="form-check">
                                        <input type="checkbox" name="campos" value="complemento_direccion" class="form-check-input" id="campo_complemento">
                                        <label class="form-check-label" for="campo_complemento">Complemento Dirección</label>
                                    </div>
                                    <div class="form-check">
                                        <input type="checkbox" name="campos" value="barrio" class="form-check-input" id="campo_barrio">
                                        <label class="form-check-label" for="campo_barrio">Barrio</label>
                                    </div>
                                    
                                    <hr class="my-2">
                                    <h6 class="text-primary mt-2"><i class="fas fa-id-card"></i> Documentos Identidad</h6>
                                    <div class="form-check">
                                        <input type="checkbox" name="campos" value="fotocopia_cedula" class="form-check-input" id="campo_fotocopia_cedula">
                                        <label class="form-check-label" for="campo_fotocopia_cedula">Fotocopia Cédula</label>
                                    </div>
                                    <div class="form-check">
                                        <input type="checkbox" name="campos" value="hoja_de_vida" class="form-check-input" id="campo_hoja_vida">
                                        <label class="form-check-label" for="campo_hoja_vida">Hoja de Vida</label>
                                    </div>
                                    <div class="form-check">
                                        <input type="checkbox" name="campos" value="libreta_militar" class="form-check-input" id="campo_libreta">
                                        <label class="form-check-label" for="campo_libreta">Libreta Militar (archivo)</label>
                                    </div>
                                    <div class="form-check">
                                        <input type="checkbox" name="campos" value="numero_libreta_militar" class="form-check-input" id="campo_num_libreta">
                                        <label class="form-check-label" for="campo_num_libreta">Número de Libreta</label>
                                    </div>
                                    <div class="form-check">
                                        <input type="checkbox" name="campos" value="distrito_militar" class="form-check-input" id="campo_distrito">
                                        <label class="form-check-label" for="campo_distrito">Distrito Militar</label>
                                    </div>
                                    <div class="form-check">
                                        <input type="checkbox" name="campos" value="clase_libreta" class="form-check-input" id="campo_clase">
                                        <label class="form-check-label" for="campo_clase">Clase de Libreta</label>
                                    </div>
                                </div>

                                <!-- Columna 2: Formación y Experiencia -->
                                <div class="col-md-4">
                                    <h6 class="text-primary"><i class="fas fa-briefcase"></i> Experiencia Laboral</h6>
                                    <div class="form-check">
                                        <input type="checkbox" name="campos" value="experiencia_laboral" class="form-check-input" id="campo_experiencia">
                                        <label class="form-check-label" for="campo_experiencia">
                                            <strong>Todas las Experiencias</strong>
                                        </label>
                                    </div>
                                    
                                    <hr class="my-2">
                                    <h6 class="text-primary mt-2"><i class="fas fa-school"></i> Educación</h6>
                                    <div class="form-check">
                                        <input type="checkbox" name="campos" value="educacion_basica" class="form-check-input" id="campo_basica">
                                        <label class="form-check-label" for="campo_basica">Educación Básica (Bachiller)</label>
                                    </div>
                                    <div class="form-check">
                                        <input type="checkbox" name="campos" value="educacion_superior" class="form-check-input" id="campo_superior">
                                        <label class="form-check-label" for="campo_superior">Técnico/Tecnólogo</label>
                                    </div>
                                    <div class="form-check">
                                        <input type="checkbox" name="campos" value="formacion_academica" class="form-check-input" id="campo_academica">
                                        <label class="form-check-label" for="campo_academica">Formación Profesional Completa</label>
                                    </div>
                                    <div class="form-check">
                                        <input type="checkbox" name="campos" value="posgrado" class="form-check-input" id="campo_posgrados">
                                        <label class="form-check-label" for="campo_posgrados">Posgrados (Maestría/Doctorado)</label>
                                    </div>
                                    <div class="form-check">
                                        <input type="checkbox" name="campos" value="especializacion" class="form-check-input" id="campo_especializaciones">
                                        <label class="form-check-label" for="campo_especializaciones">Especializaciones</label>
                                    </div>
                                    
                                    <hr class="my-2">
                                    <h6 class="text-primary mt-2"><i class="fas fa-clipboard-check"></i> Certificados Antecedentes</h6>
                                    <div class="form-check">
                                        <input type="checkbox" name="campos" value="antecedentes" class="form-check-input" id="campo_todos_antecedentes">
                                        <label class="form-check-label" for="campo_todos_antecedentes">
                                            <strong>Todos los Antecedentes</strong>
                                        </label>
                                    </div>
                                    <div class="form-check ms-3">
                                        <input type="checkbox" name="campos" value="certificado_procuraduria" class="form-check-input" id="campo_procuraduria">
                                        <label class="form-check-label" for="campo_procuraduria">Procuraduría</label>
                                    </div>
                                    <div class="form-check ms-3">
                                        <input type="checkbox" name="campos" value="certificado_contraloria" class="form-check-input" id="campo_contraloria">
                                        <label class="form-check-label" for="campo_contraloria">Contraloría</label>
                                    </div>
                                    <div class="form-check ms-3">
                                        <input type="checkbox" name="campos" value="certificado_policia" class="form-check-input" id="campo_policia">
                                        <label class="form-check-label" for="campo_policia">Policía</label>
                                    </div>
                                    <div class="form-check ms-3">
                                        <input type="checkbox" name="campos" value="certificado_medidas_correctivas" class="form-check-input" id="campo_medidas">
                                        <label class="form-check-label" for="campo_medidas">Medidas Correctivas (RNMC)</label>
                                    </div>
                                    <div class="form-check ms-3">
                                        <input type="checkbox" name="campos" value="certificado_delitos_sexuales" class="form-check-input" id="campo_delitos">
                                        <label class="form-check-label" for="campo_delitos">Delitos Sexuales</label>
                                    </div>
                                    <div class="form-check ms-3">
                                        <input type="checkbox" name="campos" value="certificado_redam" class="form-check-input" id="campo_redam">
                                        <label class="form-check-label" for="campo_redam">REDAM</label>
                                    </div>
                                </div>

                                <!-- Columna 3: Anexos Adicionales -->
                                <div class="col-md-4">
                                    <h6 class="text-primary"><i class="fas fa-folder"></i> Anexos Adicionales</h6>
                                    <div class="form-check">
                                        <input type="checkbox" name="campos" value="anexos_adicionales" class="form-check-input" id="campo_todos_anexos">
                                        <label class="form-check-label" for="campo_todos_anexos">
                                            <strong>Todos los Anexos</strong>
                                        </label>
                                    </div>
                                    <div class="form-check ms-3">
                                        <input type="checkbox" name="campos" value="anexo_03_datos_personales" class="form-check-input" id="campo_anexo03">
                                        <label class="form-check-label" for="campo_anexo03">ANEXO 03 - Datos Personales</label>
                                    </div>
                                    <div class="form-check ms-3">
                                        <input type="checkbox" name="campos" value="carta_intencion" class="form-check-input" id="campo_carta">
                                        <label class="form-check-label" for="campo_carta">Carta de Intención</label>
                                    </div>
                                    <div class="form-check ms-3">
                                        <input type="checkbox" name="campos" value="otros_documentos" class="form-check-input" id="campo_otros">
                                        <label class="form-check-label" for="campo_otros">Otros Documentos</label>
                                    </div>
                                    
                                    <hr class="my-3">
                                    <div class="alert alert-info">
                                        <small>
                                            <i class="fas fa-info-circle"></i> <strong>Nota:</strong>
                                            <ul class="mb-0 mt-2 small">
                                                <li>Campos individuales: Se marca solo ese campo</li>
                                                <li><strong>Opciones en negrita</strong>: Marcan todo el grupo</li>
                                                <li>Usa Ctrl+clic para seleccionar múltiples</li>
                                            </ul>
                                        </small>
                                    </div>
                                </div>
                            </div>

                            <div class="mt-3">
                                <button type="button" class="btn btn-sm btn-outline-primary" onclick="seleccionarTodos()">
                                    <i class="fas fa-check-double"></i> Seleccionar Todos
                                </button>
                                <button type="button" class="btn btn-sm btn-outline-secondary" onclick="deseleccionarTodos()">
                                    <i class="fas fa-times"></i> Deseleccionar Todos
                                </button>
                            </div>

                            <small class="text-muted d-block mt-2">
                                <i class="fas fa-info-circle"></i> El candidato solo podrá modificar los campos que selecciones aquí.
                            </small>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                        <button type="submit" class="btn btn-danger">Enviar Solicitud</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Información Básica -->
    <div class="detail-section">
        <h3>
            <i class="fas fa-info-circle"></i> Información Personal y de Contacto
        </h3>
        <div class="row">
            <div class="col-md-6">
                <div class="info-row">
                    <span class="info-label"><i class="fas fa-envelope"></i> Correo Electrónico:</span>
                    <span class="info-value">{{ applicant.correo }}</span>
                </div>
                <div class="info-row">
                    <span class="info-label"><i class="fas fa-phone"></i> Teléfono:</span>
                    <span class="info-value">{{ applicant.telefono }}</span>
                </div>
                <div class="info-row">
                    <span class="info-label"><i class="fas fa-map-marker-alt"></i> Dirección:</span>
                    <span class="info-value">
                        {{ applicant.tipo_via }} {{ applicant.numero_via }} # {{ applicant.numero_casa }}
                        {% if applicant.complemento_direccion %}, {{ applicant.complemento_direccion }}{% endif %}
                        {% if applicant.barrio %}, Barrio {{ applicant.barrio }}{% endif %}
                    </span>
                </div>
                <div class="info-row">
                    <span class="info-label"><i class="fas fa-venus-mars"></i> Género:</span>
                    <span class="info-value">{{ applicant.genero }}</span>
                </div>
            </div>
            <div class="col-md-6">
                <div class="info-row">
                    <span class="info-label"><i class="fas fa-user-tag"></i> Perfil:</span>
                    <span class="info-value">{{ applicant.perfil }}</span>
                </div>
                <div class="info-row">
                    <span class="info-label"><i class="fas fa-graduation-cap"></i> Área del Conocimiento:</span>
                    <span class="info-value">{{ applicant.area_del_conocimiento }}</span>
                </div>
                <div class="info-row">
                    <span class="info-label"><i class="fas fa-file-contract"></i> Contrato:</span>
                    <span class="info-value">{{ applicant.contrato }}</span>
                </div>
            </div>
        </div>

        {% if applicant.observacion %}
        <div class="info-row mt-3">
            <span class="info-label"><i class="fas fa-comment"></i> Observaciones:</span>
        </div>
        <div class="alert alert-light mt-2">
            {{ applicant.observacion }}
        </div>
        {% endif %}
    </div>

    <!-- Documentos de Identidad -->
    {% if applicant.documentos_identidad %}
    <div class="detail-section">
        <h3>
            <i class="fas fa-id-card"></i> Documentos de Identidad y Autorización
        </h3>
        <div class="row">
            <div class="col-md-6">
                <div class="info-row">
                    <span class="info-label"><i class="fas fa-file-pdf"></i> Fotocopia Cédula:</span>
                    {% if applicant.documentos_identidad.fotocopia_cedula %}
                        <a href="{{ applicant.documentos_identidad.fotocopia_cedula.url }}" target="_blank" class="btn btn-sm btn-success">
                            <i class="fas fa-eye"></i> Ver Documento
                        </a>
                    {% else %}
                        <span class="info-value text-muted">No cargado</span>
                    {% endif %}
                </div>
                <div class="info-row">
                    <span class="info-label"><i class="fas fa-file-signature"></i> Carta Autorización Datos:</span>
                    {% if applicant.documentos_identidad.carta_autorizacion_datos %}
                        <a href="{{ applicant.documentos_identidad.carta_autorizacion_datos.url }}" target="_blank" class="btn btn-sm btn-success">
                            <i class="fas fa-eye"></i> Ver Documento
                        </a>
                    {% else %}
                        <span class="info-value text-muted">No cargado</span>
                    {% endif %}
                </div>
                <div class="info-row">
                    <span class="info-label"><i class="fas fa-calendar"></i> Fecha Autorización:</span>
                    <span class="info-value">{{ applicant.documentos_identidad.fecha_autorizacion|date:"d/m/Y"|default:"No especificada" }}</span>
                </div>
            </div>
            <div class="col-md-6">
                {% if applicant.genero == 'Masculino' %}
                <div class="info-row">
                    <span class="info-label"><i class="fas fa-shield-alt"></i> Libreta Militar:</span>
                    {% if applicant.documentos_identidad.libreta_militar %}
                        <a href="{{ applicant.documentos_identidad.libreta_militar.url }}" target="_blank" class="btn btn-sm btn-success">
                            <i class="fas fa-eye"></i> Ver Documento
                        </a>
                    {% else %}
                        <span class="info-value text-muted">No cargado</span>
                    {% endif %}
                </div>
                <div class="info-row">
                    <span class="info-label"><i class="fas fa-hashtag"></i> Número Libreta:</span>
                    <span class="info-value">{{ applicant.documentos_identidad.numero_libreta_militar|default:"No especificado" }}</span>
                </div>
                <div class="info-row">
                    <span class="info-label"><i class="fas fa-map-marker-alt"></i> Distrito Militar:</span>
                    <span class="info-value">{{ applicant.documentos_identidad.distrito_militar|default:"No especificado" }}</span>
                </div>
                <div class="info-row">
                    <span class="info-label"><i class="fas fa-tag"></i> Clase Libreta:</span>
                    <span class="info-value">{{ applicant.documentos_identidad.clase_libreta|default:"No especificada" }}</span>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Antecedentes -->
    {% if applicant.antecedentes %}
    <div class="detail-section">
        <h3>
            <i class="fas fa-clipboard-check"></i> Antecedentes y Verificaciones
        </h3>
        <div class="row">
            <div class="col-md-6 mb-3">
                <div class="card h-100" style="border-left: 4px solid #e74c3c;">
                    <div class="card-body">
                        <h6 class="text-danger"><i class="fas fa-balance-scale"></i> Procuraduría</h6>
                        {% if applicant.antecedentes.certificado_procuraduria %}
                            <a href="{{ applicant.antecedentes.certificado_procuraduria.url }}" target="_blank" class="btn btn-sm btn-success">
                                <i class="fas fa-eye"></i> Ver Certificado
                            </a>
                        {% else %}
                            <span class="text-muted">No cargado</span>
                        {% endif %}
                        <p class="mb-0 mt-2"><small>Fecha: {{ applicant.antecedentes.fecha_procuraduria|date:"d/m/Y"|default:"N/A" }}</small></p>
                    </div>
                </div>
            </div>
            <div class="col-md-6 mb-3">
                <div class="card h-100" style="border-left: 4px solid #f39c12;">
                    <div class="card-body">
                        <h6 style="color: #f39c12;"><i class="fas fa-search-dollar"></i> Contraloría</h6>
                        {% if applicant.antecedentes.certificado_contraloria %}
                            <a href="{{ applicant.antecedentes.certificado_contraloria.url }}" target="_blank" class="btn btn-sm btn-success">
                                <i class="fas fa-eye"></i> Ver Certificado
                            </a>
                        {% else %}
                            <span class="text-muted">No cargado</span>
                        {% endif %}
                        <p class="mb-0 mt-2"><small>Fecha: {{ applicant.antecedentes.fecha_contraloria|date:"d/m/Y"|default:"N/A" }}</small></p>
                    </div>
                </div>
            </div>
            <div class="col-md-6 mb-3">
                <div class="card h-100" style="border-left: 4px solid #3498db;">
                    <div class="card-body">
                        <h6 class="text-primary"><i class="fas fa-user-shield"></i> Policía Nacional</h6>
                        {% if applicant.antecedentes.certificado_policia %}
                            <a href="{{ applicant.antecedentes.certificado_policia.url }}" target="_blank" class="btn btn-sm btn-success">
                                <i class="fas fa-eye"></i> Ver Certificado
                            </a>
                        {% else %}
                            <span class="text-muted">No cargado</span>
                        {% endif %}
                        <p class="mb-0 mt-2"><small>Fecha: {{ applicant.antecedentes.fecha_policia|date:"d/m/Y"|default:"N/A" }}</small></p>
                    </div>
                </div>
            </div>
            <div class="col-md-6 mb-3">
                <div class="card h-100" style="border-left: 4px solid #9b59b6;">
                    <div class="card-body">
                        <h6 style="color: #9b59b6;"><i class="fas fa-gavel"></i> Medidas Correctivas (RNMC)</h6>
                        {% if applicant.antecedentes.certificado_medidas_correctivas %}
                            <a href="{{ applicant.antecedentes.certificado_medidas_correctivas.url }}" target="_blank" class="btn btn-sm btn-success">
                                <i class="fas fa-eye"></i> Ver Certificado
                            </a>
                        {% else %}
                            <span class="text-muted">No cargado</span>
                        {% endif %}
                        <p class="mb-0 mt-2"><small>Fecha: {{ applicant.antecedentes.fecha_medidas_correctivas|date:"d/m/Y"|default:"N/A" }}</small></p>
                    </div>
                </div>
            </div>
            <div class="col-md-6 mb-3">
                <div class="card h-100" style="border-left: 4px solid #27ae60;">
                    <div class="card-body">
                        <h6 class="text-success"><i class="fas fa-child"></i> Delitos Sexuales</h6>
                        {% if applicant.antecedentes.certificado_delitos_sexuales %}
                            <a href="{{ applicant.antecedentes.certificado_delitos_sexuales.url }}" target="_blank" class="btn btn-sm btn-success">
                                <i class="fas fa-eye"></i> Ver Certificado
                            </a>
                        {% else %}
                            <span class="text-muted">No cargado</span>
                        {% endif %}
                        <p class="mb-0 mt-2"><small>Fecha: {{ applicant.antecedentes.fecha_delitos_sexuales|date:"d/m/Y"|default:"N/A" }}</small></p>
                    </div>
                </div>
            </div>
            <div class="col-md-6 mb-3">
                <div class="card h-100" style="border-left: 4px solid #e74c3c;">
                    <div class="card-body">
                        <h6 class="text-danger"><i class="fas fa-file-invoice-dollar"></i> REDAM</h6>
                        {% if applicant.antecedentes.certificado_redam %}
                            <a href="{{ applicant.antecedentes.certificado_redam.url }}" target="_blank" class="btn btn-sm btn-success">
                                <i class="fas fa-eye"></i> Ver Certificado
                            </a>
                        {% else %}
                            <span class="text-muted">No cargado</span>
                        {% endif %}
                        <p class="mb-0 mt-2"><small>Fecha: {{ applicant.antecedentes.fecha_redam|date:"d/m/Y"|default:"N/A" }}</small></p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Anexos Adicionales -->
    {% if applicant.anexos_adicionales %}
    <div class="detail-section">
        <h3>
            <i class="fas fa-paperclip"></i> Anexos Adicionales
        </h3>
        <div class="row">
            <div class="col-md-4">
                <div class="info-row">
                    <span class="info-label"><i class="fas fa-file-alt"></i> ANEXO 03:</span>
                    {% if applicant.anexos_adicionales.anexo_03_datos_personales %}
                        <a href="{{ applicant.anexos_adicionales.anexo_03_datos_personales.url }}" target="_blank" class="btn btn-sm btn-success">
                            <i class="fas fa-eye"></i> Ver
                        </a>
                    {% else %}
                        <span class="info-value text-muted">No cargado</span>
                    {% endif %}
                </div>
            </div>
            <div class="col-md-4">
                <div class="info-row">
                    <span class="info-label"><i class="fas fa-file-contract"></i> Carta Intención:</span>
                    {% if applicant.anexos_adicionales.carta_intencion %}
                        <a href="{{ applicant.anexos_adicionales.carta_intencion.url }}" target="_blank" class="btn btn-sm btn-success">
                            <i class="fas fa-eye"></i> Ver
                        </a>
                    {% else %}
                        <span class="info-value text-muted">No cargado</span>
                    {% endif %}
                </div>
            </div>
            <div class="col-md-4">
                <div class="info-row">
                    <span class="info-label"><i class="fas fa-folder-open"></i> Otros Documentos:</span>
                    {% if applicant.anexos_adicionales.otros_documentos %}
                        <a href="{{ applicant.anexos_adicionales.otros_documentos.url }}" target="_blank" class="btn btn-sm btn-success">
                            <i class="fas fa-eye"></i> Ver
                        </a>
                    {% else %}
                        <span class="info-value text-muted">No cargado</span>
                    {% endif %}
                </div>
            </div>
        </div>
        {% if applicant.anexos_adicionales.descripcion_otros %}
        <div class="alert alert-light mt-3">
            <strong>Descripción de otros documentos:</strong><br>
            {{ applicant.anexos_adicionales.descripcion_otros }}
        </div>
        {% endif %}
    </div>
    {% endif %}

    <!-- Experiencia Laboral -->
    <div class="detail-section">
        <h3>
            <i class="fas fa-history"></i> Experiencia Laboral
        </h3>
        {% if applicant.experiencias_laborales.all %}
            <div class="row">
                {% for experiencia in applicant.experiencias_laborales.all %}
                <div class="col-md-6 mb-3">
                    <div class="card h-100" style="border-left: 4px solid #3498db;">
                        <div class="card-body">
                            <h5 class="card-title text-primary">
                                <i class="fas fa-briefcase"></i> {{ experiencia.cargo }}
                            </h5>
                            <p class="mb-2">
                                <span class="badge bg-secondary">{{ experiencia.cargo_anexo_11 }}</span>
                            </p>
                            <p class="mb-2">
                                <i class="fas fa-calendar-alt"></i>
                                <strong>Período:</strong> {{ experiencia.fecha_inicial|date:"d/m/Y" }} - {{ experiencia.fecha_terminacion|date:"d/m/Y" }}
                            </p>
                            <p class="mb-2">
                                <i class="fas fa-clock"></i>
                                <strong>Duración:</strong> {{ experiencia.meses_experiencia }} meses, {{ experiencia.dias_experiencia }} días
                                {% if experiencia.dias_residual_experiencia %}
                                    ({{ experiencia.dias_residual_experiencia }} días residuales)
                                {% endif %}
                            </p>
                            <p class="mb-2">
                                <strong>Objeto Contractual:</strong><br>
                                {{ experiencia.objeto_contractual }}
                            </p>
                            <p class="mb-2">
                                <strong>Funciones:</strong><br>
                                {{ experiencia.funciones }}
                            </p>
                            {% if experiencia.certificado_laboral %}
                                <a href="{{ experiencia.certificado_laboral.url }}" target="_blank" class="btn btn-sm btn-success">
                                    <i class="fas fa-file-pdf"></i> Ver Certificado
                                </a>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="alert alert-info">
                <i class="fas fa-info-circle"></i> No hay experiencia laboral registrada.
            </div>
        {% endif %}
    </div>

    <!-- Educación Básica (Bachiller) -->
    <div class="detail-section">
        <h3>
            <i class="fas fa-school"></i> Educación Básica (Bachiller)
        </h3>
        {% if applicant.educacion_basica.all %}
            <div class="row">
                {% for basica in applicant.educacion_basica.all %}
                <div class="col-md-6 mb-3">
                    <div class="card h-100" style="border-left: 4px solid #1abc9c;">
                        <div class="card-body">
                            <h5 class="card-title" style="color: #1abc9c;">
                                <i class="fas fa-certificate"></i> {{ basica.titulo }}
                            </h5>
                            <p class="mb-2">
                                <i class="fas fa-school"></i>
                                <strong>Institución:</strong> {{ basica.institucion }}
                            </p>
                            <p class="mb-2">
                                <i class="fas fa-calendar-check"></i>
                                <strong>Año de Grado:</strong> {{ basica.anio_grado }}
                            </p>
                            {% if basica.acta_grado_diploma %}
                                <a href="{{ basica.acta_grado_diploma.url }}" target="_blank" class="btn btn-sm btn-outline-success mt-2">
                                    <i class="fas fa-file-pdf"></i> Ver Diploma/Acta
                                </a>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="alert alert-info">
                <i class="fas fa-info-circle"></i> No hay educación básica registrada.
            </div>
        {% endif %}
    </div>

    <!-- Educación Superior (Técnico/Tecnólogo) -->
    <div class="detail-section">
        <h3>
            <i class="fas fa-cogs"></i> Educación Superior (Técnico/Tecnólogo)
        </h3>
        {% if applicant.educacion_superior.all %}
            <div class="row">
                {% for superior in applicant.educacion_superior.all %}
                <div class="col-md-6 mb-3">
                    <div class="card h-100" style="border-left: 4px solid #e67e22;">
                        <div class="card-body">
                            <h5 class="card-title" style="color: #e67e22;">
                                <i class="fas fa-user-graduate"></i> {{ superior.titulo }}
                            </h5>
                            <p class="mb-2">
                                <span class="badge bg-secondary">{{ superior.nivel }}</span>
                            </p>
                            <p class="mb-2">
                                <i class="fas fa-university"></i>
                                <strong>Institución:</strong> {{ superior.institucion }}
                            </p>
                            <p class="mb-2">
                                <i class="fas fa-calendar-check"></i>
                                <strong>Fecha Grado:</strong> {{ superior.fecha_grado|date:"d/m/Y" }}
                            </p>
                            {% if superior.tarjeta_profesional %}
                            <p class="mb-2">
                                <i class="fas fa-id-card"></i>
                                <strong>Tarjeta Prof:</strong> {{ superior.tarjeta_profesional }}
                            </p>
                            {% endif %}
                            {% if superior.documento_soporte %}
                                <a href="{{ superior.documento_soporte.url }}" target="_blank" class="btn btn-sm btn-outline-success mt-2">
                                    <i class="fas fa-file-pdf"></i> Ver Soporte
                                </a>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="alert alert-info">
                <i class="fas fa-info-circle"></i> No hay educación superior técnica/tecnológica registrada.
            </div>
        {% endif %}
    </div>

    <!-- Información Académica -->
    <div class="detail-section">
        <h3>
            <i class="fas fa-graduation-cap"></i> Formación Académica
        </h3>
        {% if applicant.formacion_academica.all %}
            <div class="row">
                {% for formacion in applicant.formacion_academica.all %}
                <div class="col-md-6 mb-3">
                    <div class="card h-100" style="border-left: 4px solid #27ae60;">
                        <div class="card-body">
                            <h5 class="card-title text-success">
                                <i class="fas fa-graduation-cap"></i> {{ formacion.profesion }}
                            </h5>
                            <p class="mb-2">
                                <i class="fas fa-university"></i>
                                <strong>Universidad:</strong> {{ formacion.universidad }}
                            </p>
                            <p class="mb-2">
                                <i class="fas fa-id-card"></i>
                                <strong>Tarjeta Profesional:</strong> {{ formacion.tarjeta_profesional }}
                            </p>
                            <p class="mb-2">
                                <i class="fas fa-hashtag"></i>
                                <strong>Número:</strong> {{ formacion.numero_tarjeta_resolucion }}
                            </p>
                            <p class="mb-2">
                                <i class="fas fa-calendar"></i>
                                <strong>Fecha Expedición:</strong> {{ formacion.fecha_expedicion|date:"d/m/Y" }}
                            </p>
                            <p class="mb-2">
                                <i class="fas fa-calendar-check"></i>
                                <strong>Fecha Grado:</strong> {{ formacion.fecha_grado|date:"d/m/Y" }}
                            </p>
                            <p class="mb-2">
                                <i class="fas fa-clock"></i>
                                <strong>Experiencia en la profesión:</strong> {{ formacion.meses_experiencia_profesion }} meses
                            </p>
                            <!-- Documentos académicos -->
                            <hr class="my-2">
                            <div class="mt-2">
                                {% if formacion.fotocopia_titulo %}
                                    <a href="{{ formacion.fotocopia_titulo.url }}" target="_blank" class="btn btn-sm btn-outline-success me-1 mb-1">
                                        <i class="fas fa-file-pdf"></i> Título
                                    </a>
                                {% endif %}
                                {% if formacion.fotocopia_tarjeta_profesional %}
                                    <a href="{{ formacion.fotocopia_tarjeta_profesional.url }}" target="_blank" class="btn btn-sm btn-outline-primary me-1 mb-1">
                                        <i class="fas fa-id-badge"></i> Tarjeta Prof.
                                    </a>
                                {% endif %}
                                {% if formacion.certificado_vigencia_tarjeta %}
                                    <a href="{{ formacion.certificado_vigencia_tarjeta.url }}" target="_blank" class="btn btn-sm btn-outline-info me-1 mb-1">
                                        <i class="fas fa-certificate"></i> Vigencia
                                    </a>
                                {% endif %}
                            </div>
                            {% if formacion.fecha_vigencia_tarjeta %}
                            <p class="mb-0 mt-2"><small class="text-muted">Vigencia hasta: {{ formacion.fecha_vigencia_tarjeta|date:"d/m/Y" }}</small></p>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="alert alert-info">
                <i class="fas fa-info-circle"></i> No hay formación académica registrada.
            </div>
        {% endif %}
    </div>

    <!-- Posgrados -->
    <div class="detail-section">
        <h3>
            <i class="fas fa-award"></i> Posgrados (Maestrías, Doctorados)
        </h3>
        {% if applicant.posgrados.all %}
            <div class="row">
                {% for posgrado in applicant.posgrados.all %}
                <div class="col-md-4 mb-3">
                    <div class="card h-100" style="border-left: 4px solid #9b59b6;">
                        <div class="card-body">
                            <h5 class="card-title" style="color: #9b59b6;">
                                <i class="fas fa-award"></i> {{ posgrado.nombre_posgrado }}
                            </h5>
                            <p class="mb-2">
                                <i class="fas fa-university"></i>
                                <strong>Universidad:</strong> {{ posgrado.universidad }}
                            </p>
                            <p class="mb-2">
                                <i class="fas fa-calendar-check"></i>
                                <strong>Terminación:</strong> {{ posgrado.fecha_terminacion|date:"d/m/Y" }}
                            </p>
                            <p class="mb-0">
                                <i class="fas fa-clock"></i>
                                <strong>Experiencia:</strong> {{ posgrado.meses_de_experiencia }} meses
                            </p>
                            {% if posgrado.acta_grado_diploma %}
                                <hr class="my-2">
                                <a href="{{ posgrado.acta_grado_diploma.url }}" target="_blank" class="btn btn-sm btn-outline-success w-100">
                                    <i class="fas fa-file-pdf"></i> Ver Diploma/Acta
                                </a>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="alert alert-info">
                <i class="fas fa-info-circle"></i> No hay posgrados registrados.
            </div>
        {% endif %}
    </div>

    <!-- Especializaciones -->
    <div class="detail-section">
        <h3>
            <i class="fas fa-certificate"></i> Especializaciones
        </h3>
        {% if applicant.especializaciones.all %}
            <div class="row">
                {% for especializacion in applicant.especializaciones.all %}
                <div class="col-md-4 mb-3">
                    <div class="card h-100" style="border-left: 4px solid #e67e22;">
                        <div class="card-body">
                            <h5 class="card-title" style="color: #e67e22;">
                                <i class="fas fa-certificate"></i> {{ especializacion.nombre_especializacion }}
                            </h5>
                            <p class="mb-2">
                                <i class="fas fa-university"></i>
                                <strong>Universidad:</strong> {{ especializacion.universidad }}
                            </p>
                            <p class="mb-2">
                                <i class="fas fa-calendar-check"></i>
                                <strong>Terminación:</strong> {{ especializacion.fecha_terminacion|date:"d/m/Y" }}
                            </p>
                            <p class="mb-0">
                                <i class="fas fa-clock"></i>
                                <strong>Experiencia:</strong> {{ especializacion.meses_de_experiencia }} meses
                            </p>
                            {% if especializacion.acta_grado_diploma %}
                                <hr class="my-2">
                                <a href="{{ especializacion.acta_grado_diploma.url }}" target="_blank" class="btn btn-sm btn-outline-success w-100">
                                    <i class="fas fa-file-pdf"></i> Ver Diploma/Acta
                                </a>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="alert alert-info">
                <i class="fas fa-info-circle"></i> No hay especializaciones registradas.
            </div>
        {% endif %}
    </div>

    <!-- Cálculo de Experiencia -->
    {% if applicant.calculo_experiencia %}
    <div class="detail-section">
        <h3>
            <i class="fas fa-calculator"></i> Cálculo de Experiencia Total
        </h3>
        <div class="row">
            <div class="col-md-3">
                <div class="card text-center" style="background: linear-gradient(135deg, #3498db 0%, #2980b9 100%); color: white;">
                    <div class="card-body">
                        <h6>Total Meses</h6>
                        <h2>{{ applicant.calculo_experiencia.total_meses_experiencia }}</h2>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center" style="background: linear-gradient(135deg, #27ae60 0%, #229954 100%); color: white;">
                    <div class="card-body">
                        <h6>Total Días</h6>
                        <h2>{{ applicant.calculo_experiencia.total_dias_experiencia }}</h2>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center" style="background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%); color: white;">
                    <div class="card-body">
                        <h6>Total Años</h6>
                        <h2>{{ applicant.calculo_experiencia.total_experiencia_anos }}</h2>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center" style="background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%); color: white;">
                    <div class="card-body">
                        <h6>Años y Meses</h6>
                        <h3>{{ applicant.calculo_experiencia.anos_y_meses_experiencia }}</h3>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Botón de retorno -->
    <div class="text-center mt-4 mb-5">
        <a href="{% url 'formapp:applicant_list' %}" class="btn btn-primary btn-lg px-5">
            <i class="fas fa-arrow-left"></i> Volver a la Lista
        </a>
    </div>
</div>

<script>
// Funciones para seleccionar/deseleccionar campos en el modal de corrección
function seleccionarTodos() {
    document.querySelectorAll('input[name="campos"]').forEach(checkbox => {
        checkbox.checked = true;
    });
}

function deseleccionarTodos() {
    document.querySelectorAll('input[name="campos"]').forEach(checkbox => {
        checkbox.checked = false;
    });
}

// Validar que se seleccione al menos un campo antes de enviar
document.querySelector('form[action*="solicitar-correccion"]').addEventListener('submit', function(e) {
    const campos = document.querySelectorAll('input[name="campos"]:checked');
    if (campos.length === 0) {
        e.preventDefault();
        alert('Por favor selecciona al menos un campo que el candidato deba corregir.');
        return false;
    }
});
</script>

{% endblock %}
